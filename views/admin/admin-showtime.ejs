<%- include ('../layouts/header')%>
    <% function convertDate(date){%>
        <% var newDate=new Date(date);%>
            <% return newDate.toLocaleDateString('en-GB');%>
                <%} %>

                    <body>
                        <%- include ('../layouts/admin-sub-header')%>
                            <div class="wrapper-index">
                                <div class="ad-movie">
                                    <div style="display: flex;
                                    justify-content: space-between;
                                    align-items: center;">
                                        <div class="h5-detail">Quản lý suất chiếu</div>
                                        <button type="button" id="btnAddShowTime" class="btn-common btn1"
                                            data-toggle="modal" data-target=".bd-example-modal-lg"><i class="fa fa-plus"
                                                aria-hidden="true"></i>
                                            Thêm mới</button>
                                    </div>
                                    <!-- Add suất chiếu -->
                                    <form class="formAdd" action="" method="">
                                        <div id="modalAddShowTime" class="modal">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h4 class="modal-title">Thêm suất chiếu</h4>
                                                    <button type="button" class="close-showTime close"
                                                        data-dismiss="modal">&times;</button>
                                                </div>
                                                <div class="modal-body-plus">
                                                    <div class="wrapModal">
                                                        <div class="rowShowTime">
                                                            <label style="width: 150px;" for="">Chọn phim</label>
                                                            <div class="rowST">
                                                                <select name="idAndTime" id="phim" class="form-select">
                                                                    Chọn phim
                                                                    <%films.forEach(function(film){%>
                                                                        <option value="<%=film._id%>/<%=film.time%>">
                                                                            <%=film.nameEN%>
                                                                        </option>
                                                                        <%})%>
                                                                </select>
                                                                <span class="span-error"></span>
                                                            </div>
                                                        </div>
                                                        <div class="rowShowTime">
                                                            <div class="rowST">
                                                                <label style="width: 150px;" for="">Ngày chiếu</label>
                                                                <div class="form-user">
                                                                    <input name="date" id="date"
                                                                        class="date-lc dateAdd form-select"
                                                                        style="background-image: none;" type="date"
                                                                        style="width:100%">
                                                                    <span class="span-error-add"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div id="form-addSC">
                                                            <div class="row first-row-addSc lc-suatchieu">
                                                                <div class="choose-showtime">
                                                                    <label for="">Suất chiếu</label>
                                                                    <input class="form-control" type="time" name="timeStart" id="">
                                                                </div>
                                                                <div class="choose-showtime">
                                                                    <label style="width: 80px">Rạp</label>
                                                                    <select id="room" name="room" class="form-select">
                                                                        <%rooms.forEach(function(room){%>
                                                                            <option value="<%=room._id%>"><%=room.name%></option>
                                                                        <%})%>                                                 
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <button class="btn-SC" id="btnAddSC" type="button">Thêm suất
                                                            chiếu</button>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <p class="alertAdd" style="color: red;"></p>
                                                    <button type="button"
                                                        class="btn btn-secondary close-showTime">Đóng</button>
                                                    <button type="button" class="btn-common btn-saveAdd">Thêm</button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                    <span class="line-detail"></span>
                                    <table class="table table-striped table-bordered" style="font-size: 15px;">
                                        <thead>
                                            <tr>
                                                <form action="">
                                                    <div class="ad-phim1"
                                                        style="justify-content: space-between; margin-top: 20px; align-items: flex-start;">
                                                        <select name="" class="form-select filmSelect"
                                                            style="width: 50%;">
                                                            <option value=""> Tất cả phim </option>
                                                            <%films.forEach(function(film){%>
                                                                <option value="<%=film._id%>">
                                                                    <%=film.nameEN%>
                                                                </option>
                                                                <%})%>

                                                        </select>
                                                </form>
                                                <form class="formSearch" action="" method="POST">
                                                    <div class="label-date" style=" align-items: flex-start;">
                                                        <label class="labeltime">Từ</label>
                                                        <div class="input-date">
                                                            <input type="hidden" name="nameEN" value="" id="">
                                                            <input style="background-image: none;"
                                                                class="date-lc1 form-select" name="datefrom"
                                                                type="datetime-local" value="">
                                                            <span class="span-error" id="timefrom_error"></span>
                                                        </div>
                                                        <label class="labeltime">Đến</label>
                                                        <div class="input-date">
                                                            <input style="background-image: none;"
                                                                class="date-lc1 form-select" name="dateto"
                                                                type="datetime-local" value="">

                                                            <span class="span-error" id="timeto_error">

                                                        </div>
                                                        <button class="submitsearch btn btn-buy btnSearchTime"
                                                            type="submit">Tìm kiếm</button>

                                                    </div>
                                                </form>
                                </div>
                                </tr>
                                <tr>
                                    <th scope="col">STT</th>
                                    <th scope="col">Phim</th>
                                    <th scope="col">Ngày chiếu</th>
                                    <th scope="col" style="width: 50%;">Suất chiếu </th>
                                    <th scope="col" style="width: 1%;">
                                </tr>
                                </thead>
                                <tbody id="containTr">
                                    <form class="formDeleteAll" action="" method="post">
                                        <!-- Each film's show time -->
                                        <%var i=1;%>
                                            <% showtimes.forEach(function(showtime){ %>

                                                <tr class="trClosest">
                                                    <th style=" width: 20px;">
                                                        <%=i%>
                                                            <%i++%>
                                                    </th>
                                                    <td class="tdName" style="width: 20%;">
                                                        <div class="wrapFilm">
                                                            <div class="h5-poster" style="color: #333">
                                                                <%=showtime.nameEN%>
                                                            </div>
                                                            <div class="side-poster" style="color: #333">
                                                                <%=showtime.nameVN%>
                                                            </div>
                                                            <div>
                                                                <img class="poster-movie" style="width: 100%" src="<%=showtime.photo%>"
                                                                    alt="Megas Cinema">
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="tdDate">
                                                        <div class="dateShowTime">
                                                            
                                                            <%showtime.descrb.sort(function(a, b){ %>
                                                                <%    if (a.nameDate.toLowerCase() < b.nameDate.toLowerCase()) {return -1;} %>
                                                                <%    if (a.nameDate.toLowerCase() > b.nameDate.toLowerCase()) {return 1;} %>
                                                                <%    return 0; %>
                                                                <%})%>
                                                            <%showtime.descrb.forEach(function(date){%>
                                                                <div>
                                                                    <span><%=convertDate(date.nameDate)%></span>
                                                                </div>
                                                            <%})%> 
                                                            
                                                        </div>
                                                    </td>
                                                    <td class="tdTime">
                                                        
                                                            <div class="timeShowTime">

                                                                <!-- The show time of date -->
                                                                <%showtime.descrb.forEach(function(date){%>
                                                                    
                                                                        <div>
                                                                            <%date.times.sort(); %>   
                                                                            <%date.times.forEach(function(time){%>
                                                                                <%newSt=time.split(':');%>
                                                                                <%if (newSt[0]<12){ %>
                                                                                    
                                                                                        <div><%=time%> AM</div>
                                                                                    
                                                                                <%} else { %>
                                                                                    
                                                                                        <div><%=time%> PM</div>
                                                                                    
                                                                                <%}%>
                                                                                
                                                                            <%})%>                                                           
                                                                        </div>
                                                                   
                                                                <%})%>                                                      
                                                            </div>
                                                       
                                                    </td>
                                                    <td class="tdOption" style="width: 11%;">
                                                        <div class="optionShowTime">
                                                            <%showtime.descrb.forEach(function(date){%>
                                                                <div class="btn-mode">
                                                                    <button idFilm="<%=showtime.idFilm%>" date="<%=date.nameDate%>" type="button" class="btnEditShowTime" value=""><i
                                                                            class="fa fa-pencil-square-o"
                                                                            aria-hidden="true"></i></button>
                                                                    <button idFilm="<%=showtime.idFilm%>" date="<%=date.nameDate%>" type="button">
                                                                        <i class="fa fa-times"
                                                                            aria-hidden="true"></i></button>
                                                                </div>
                                                            <%})%>                                                                                                           
                                                        </div>
                                                    </td>
                                                </tr>
                                                <%})%>

                                                    <!-- End each film's show time -->
                                    </form>
                                </tbody>
                                </thead>
                                <!-- Edit Suất chiếu từng ngày-->
                                <form class="" action="" method="">
                                    <div id="modalEditShowTime" class="modal">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title"> <i class="fa fa-pencil" aria-hidden="true"></i>
                                                    Chỉnh sửa suất chiếu</h4>
                                                <button type="button" class="close-showTime close"
                                                    data-dismiss="modal">&times;</button>
                                            </div>
                                            <div class="modal-body-plus">
                                                <div class="wrapModal">
                                                    <div class="rowShowTime">
                                                        <label style="width: 150px;" for="">Tên phim</label>
                                                        <div class="nameEdit rowST">
                                                            PHIM SỐ 1
                                                        </div>
                                                    </div>
                                                    <div class="rowShowTime">
                                                        <div class="rowST">
                                                            <label style="width: 150px;" for="">Ngày chiếu</label>
                                                            <div class="dateEdit">12/10/2022</div> 
                                                        </div>
                                                    </div>
                                                    <div id="">
                                                        <div class="row first-row-editSc lc-suatchieu">
                                                            <div class="col-5 showTimeComponent">
                                                                <label for="">Suất chiếu</label>
                                                                <input type="time" name="timeStart" id="">
                                                            </div>
                                                            <div class="col-5 showTimeComponent">
                                                                <label for="">Rạp</label>
                                                                <select id="room" name="room" class="form-select">
                                                                    <option value="1">CINEMA 1</option>
                                                                    <option value="2">CINEMA 2</option>
                                                                    <option value="3">CINEMA 3</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-2">
                                                                <button type="button" class="btnDelSC"> <i
                                                                        class="fa fa-times"
                                                                        aria-hidden="true"></i></button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <p class="" style="color: red;"></p>
                                                <button type="button"
                                                    class="btn btn-secondary close-showTime">Đóng</button>
                                                <button type="button" class="saveEdit btn-common">Xác nhận</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                </table>

                            </div>
                            <script src="../js/bootstrap.min.js"></script>
                            <script src="/js/admin-showtime.js"></script>
                    </body>

                    </html>